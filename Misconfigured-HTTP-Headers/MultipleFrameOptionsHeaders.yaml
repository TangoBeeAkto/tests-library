id: MULTIPLE_FRAME_OPTIONS_HEADERS
info:
  name: Multiple Frame Options Headers
  description: "The response contains multiple Frame Options headers."
  details: >
    ""
  impact: >
    ""
  category:
    name: MHH
    shortName: Misconfigured HTTP Headers
    displayName: Misconfigured HTTP Headers (MHH)
  subCategory: MULTIPLE_FRAME_OPTIONS_HEADERS
  severity: LOW
  tags: 
    - Business logic
    - OWASP top 10
    - HackerOne top 10
    # TODO: Fix references, cve, cwe
  references:
    - "https://web.dev/security-headers/"
    - "https://www.keycdn.com/blog/http-security-headers"
    - "https://www.invicti.com/white-papers/whitepaper-http-security-headers"
  cwe:
    - CWE-693
  cve:
    - CVE-2022-41915
    - CVE-2022-37436

api_selection_filters:
  response_code:
    gte: 200
    lt: 300
  method:
    neq: "OPTIONS"
  response_headers:
    for_one:
      key: X-Frame-Options
      value:
        regex: "(?=.*\bDENY\b)(?=.*\bSAMEORIGIN\b)|(?=.*\bDENY\b)(?=.*\bALLOW FROM\b)|(?=.*\bSAMEORIGIN\b)(?=.*\bALLOW FROM\b)"

execute:
  type: single
  requests:
    - req: []

validate:
  response_code:
    gte: 200
    lt: 300
  response_headers:
    - for_one:
        key:
          not_contains:
            - Cache-Control
            - Clear-Site-Data
            - Content-Security-Policy
            - Cross-Origin-Embedder-Policy
            - Cross-Origin-Opener-Policy
            - Cross-Origin-Resource-Policy
            - Permissions-Policy
            - Pragma
            - Referrer-Policy
            - Strict-Transport-Security
            - X-Content-Type-Options
            - X-Permitted-Cross-Domain-Policies
    - for_one:
      key: X-Frame-Options
      value:
        regex: "(?=.*\bDENY\b)(?=.*\bSAMEORIGIN\b)|(?=.*\bDENY\b)(?=.*\bALLOW FROM\b)|(?=.*\bSAMEORIGIN\b)(?=.*\bALLOW FROM\b)"

strategy:
  run_once: /